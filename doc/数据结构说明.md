# 医疗沟通APP - 数据结构扩展说明

## 概述
重新设计了APP的数据结构，使其具有高度的可扩展性和可维护性。新的架构支持动态添加内容，便于后期扩展功能。

## 🏗️ 新架构设计

### 1. 配置系统 (AppConfig)
```javascript
const AppConfig = {
    settings: {
        autoAdvanceDelay: 500,      // 可调节的延迟时间
        buttonsPerPage: 6,          // 可调节的分页大小
        speechRate: 0.8,            // 可调节的语音速度
    },
    levels: { ... },                // 层级定义
    items: { ... },                 // 项目定义
    actions: { ... },               // 动作定义
    sentenceTemplates: { ... },     // 句式模板
    itemActionMapping: { ... }      // 映射关系
}
```

### 2. 数据访问层 (DataManager)
提供统一的数据访问接口：
- `getPersons()` - 获取人员列表
- `getCategories()` - 获取类别列表
- `getItemsByCategory(category)` - 获取指定类别的项目
- `getActionsByItem(item)` - 获取指定项目的动作
- `addPerson()`, `addCategory()`, `addItem()`, `addAction()` - 动态添加数据

### 3. 智能句子构建器 (SentenceBuilder)
- 基于模板的句子生成
- 智能动作类型识别
- 支持多种句式模板

## 📊 数据结构详解

### 层级定义 (levels)
```javascript
levels: {
    person: {
        id: 0,
        name: '人称',
        description: '选择说话的人',
        items: [
            { 
                id: 'me',           // 唯一标识符
                text: '我',         // 显示文字
                value: '我',        // 实际值
                category: 'self'    // 分类标签
            }
        ]
    }
}
```

### 项目定义 (items)
```javascript
items: {
    clothing: {
        category: '衣',
        name: '衣物用品',
        items: [
            { 
                id: 'shirt',
                text: '衣服',
                value: '衣服',
                tags: ['上身', '日常']  // 标签用于搜索和分类
            }
        ]
    }
}
```

### 动作定义 (actions)
```javascript
actions: {
    clothing: {
        name: '衣物动作',
        actions: [
            { 
                id: 'wear',
                text: '穿',
                value: '穿',
                type: 'put_on'      // 动作类型，用于句式选择
            }
        ]
    }
}
```

### 句式模板 (sentenceTemplates)
```javascript
sentenceTemplates: {
    medical: {
        positive: '{person}需要{item}',
        negative: '{person}不需要{item}',
        symptom: '{person}{item}{action}',
        default: '{person}{action}{item}'
    }
}
```

## 🚀 扩展能力

### 1. 添加新人员角色
```javascript
DataManager.addPerson({
    id: 'therapist',
    text: '治疗师',
    value: '治疗师',
    category: 'medical'
});
```

### 2. 添加新类别
```javascript
DataManager.addCategory({
    id: 'entertainment',
    text: '娱',
    value: '娱',
    color: '#e8f5e8',
    priority: 7
});
```

### 3. 批量添加项目
```javascript
const entertainmentItems = [
    { id: 'tv', text: '电视', value: '电视', tags: ['娱乐', '视觉'] },
    { id: 'music', text: '音乐', value: '音乐', tags: ['娱乐', '听觉'] }
];

entertainmentItems.forEach(item => {
    DataManager.addItem('entertainment', item);
});
```

### 4. 自定义句式模板
```javascript
AppConfig.sentenceTemplates.entertainment = {
    consume: '{person}要{action}{item}',
    interact: '{person}想{action}{item}',
    default: '{person}要{action}{item}'
};
```

## 🔧 扩展方法

### 方法1: 直接API调用
```javascript
// 添加新的医疗设备类别
DataManager.addCategory({
    id: 'equipment',
    text: '设备',
    value: '设备',
    color: '#f0f0f0',
    priority: 10
});

// 添加设备项目
DataManager.addItem('equipment', {
    id: 'ventilator',
    text: '呼吸机',
    value: '呼吸机',
    tags: ['医疗设备', '生命支持']
});
```

### 方法2: JSON配置文件
```json
{
    "levels": {
        "equipment": {
            "id": 6,
            "name": "设备",
            "description": "医疗设备选择",
            "items": [...]
        }
    },
    "items": {
        "equipment": {
            "category": "设备",
            "name": "医疗设备",
            "items": [...]
        }
    }
}
```

### 方法3: 批量导入
```javascript
// 从外部文件导入
loadDataFromJSON('./custom-data.json');

// 或批量导入
importBulkData();
```

## 📈 数据管理工具

### 搜索功能
```javascript
// 搜索包含关键词的项目
const results = DataTools.searchItems('药');

// 按标签筛选
const medicalItems = DataTools.filterByTag('医疗');
```

### 统计信息
```javascript
const stats = DataTools.getStatistics();
console.log(`总计: ${stats.totalItems}个项目, ${stats.totalActions}个动作`);
```

### 数据验证
```javascript
const validation = DataTools.validateIntegrity();
if (!validation.isValid) {
    console.log('数据问题:', validation.issues);
}
```

## 💾 数据持久化

### 导出配置
```javascript
// 导出当前配置为JSON文件
exportCurrentData();
```

### 版本管理
- 每个配置文件包含时间戳和版本号
- 支持配置回滚和版本对比
- 可追踪数据变更历史

## 🎯 扩展优势

### 1. **结构化设计**
- 清晰的层次结构
- 标准化的数据格式
- 一致的命名规范

### 2. **高度可扩展**
- 动态添加任何类型的数据
- 支持自定义句式模板
- 灵活的映射关系

### 3. **易于维护**
- 数据与逻辑分离
- 统一的数据访问接口
- 完整的验证机制

### 4. **向后兼容**
- 保持原有功能不变
- 渐进式升级
- 平滑的数据迁移

## 📝 使用建议

### 1. **添加新内容时**
- 使用DataManager的API方法
- 遵循现有的数据格式
- 添加适当的标签和分类

### 2. **自定义句式时**
- 使用模板变量 {person}, {item}, {action}
- 考虑不同的动作类型
- 测试句子的自然度

### 3. **批量导入时**
- 先验证数据格式
- 使用事务性操作
- 备份原有数据

这个新的数据结构为APP的长期发展和功能扩展奠定了坚实的基础。
